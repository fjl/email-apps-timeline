<!DOCTYPE HTML>
<html>
<head>
  <title>The History of Email Apps</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.10.0/vis.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.1.6/zepto.min.js"></script>
  <script src="assets/javascripts/base.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.10.0/vis.min.css" rel="stylesheet" type="text/css" />
  <link href="assets/stylesheets/application.css" rel="stylesheet" type="text/css">
</head>

<body>
<header class="topbar collapsed">
  <div class="topbar-container">
    <div class="topbar-left"><a class="nav-link" href="https://missiveapp.com/blog" target="_blank">About</a></div>
    <h1>The History of Email Apps</h1>
    <div class="topbar-right">
      <div class="nav-share">
        <span>Share it on:</span>
        <a href="https://missiveapp.com/blog" target="_blank"><img src="assets/images/twitter.svg" alt="Twitter"></a>
        <a href="https://missiveapp.com/blog" target="_blank"><img src="assets/images/facebook.svg" alt="Facebook"></a>
        <a href="https://missiveapp.com/blog" target="_blank"><img src="assets/images/google-plus.svg" alt="Google Plus"></a>
      </div>
    </div>
  </div>
</header>

<div id="visualization" class="timeline">
  <div class="timeline-legend white-box">
    <ul class="white-box-section">
      <li><i class="vis-item generic"></i><span class="legend-label">Developped</span></li>
      <li><i class="vis-item acquired"></i><span class="legend-label">Acquired</span></li>
      <li><i class="vis-item discontinued"></i><span class="legend-label">Discontinued</span></li>
      <li><i class="timeline-event"><span></span></i><span class="legend-label">Major Event</span></li>
      <li><i class="timeline-now"><span></span></i><span class="legend-label">Today</span></li>
    </ul>
    <div class="legend-details white-box-section">
      <small>Brought to you by the folks at <a href="https://missiveapp.com" target="_blank">Missive</a>.</small>
      <small>If you see an app missing, please <a href="#" target="_blank">suggest it on Github</a>.</small>
    </div>
  </div>
</div>

<!-- Group templates -->
<script id="group-template" type="text/x-handlebars-template">
</script>

<!-- Item templates -->
<script id="item-generic" type="text/x-handlebars-template">
  <a class="app-link" href="{{url}}" title="{{title}}" target="_blank">{{title}}</a>
</script>

<script id="item-acquired" type="text/x-handlebars-template">
  <a class="app-link" href="{{url}}" title="{{title}}" target="_blank"></a>
</script>

<script id="item-discontinued" type="text/x-handlebars-template">
  <a class="app-link" href="{{url}}" title="{{title}}" target="_blank"></a>
</script>

<script id="item-background" type="text/x-handlebars-template">
  {{content}}
</script>

<script src="assets/javascripts/groups.js"></script>
<script src="assets/javascripts/items.js"></script>

<script type="text/javascript">
  var templates = {
    generic: Handlebars.compile(document.getElementById('item-generic').innerHTML),
    acquired: Handlebars.compile(document.getElementById('item-acquired').innerHTML),
    discontinued: Handlebars.compile(document.getElementById('item-discontinued').innerHTML),
    background: Handlebars.compile(document.getElementById('item-background').innerHTML),
  };

  var container = document.getElementById('visualization');

  var min = 1979
    , max = 2017

  var options = {
    timeAxis: {scale: 'year', step: 1},
    min: min.toString(),
    max: max.toString(),
    start: min.toString(),
    end: max.toString(),
    orientation: 'top',
    width: ((max - min) * 110) + 'px', // number of years x width in pixels
    height: ((items.length * 12) - 40) + 'px', // number of items x height in pixels (w/ adjustement)
    margin: { axis: 25, item: 4 },
    moveable: false,
    showCurrentTime: true,
    selectable: false,
    zoomable: false,
    stack: false,
    throttleRedraw: 16.666666667,
    groupTemplate: Handlebars.compile(document.getElementById('group-template').innerHTML),
    template: function (item) {
      var template = templates[item.eventType];
      return template(item);
    },
    groupOrder: function(itemA, itemB){
      if (itemA.start > itemB.start) return -1;
      if (itemA.start < itemB.start) return 1;
      return 0;
    }
  };

  var timeline = new vis.Timeline(container, items, groups, options);

  // Dragging
  var $foreground = $('.vis-foreground')
    , dragging = false
    , previousDragPosition = null
    , body = document.body
    , wasDragging = false

  // Scroll at top right on page load
  setTimeout(function() {
    body.scrollLeft = body.scrollWidth
    body.scrollTop  = 0
  }, 0)

  $foreground.on('mousedown', function(e) {
    wasDragging = false
    dragging = true
    previousDragPosition = [e.clientX, e.clientY]
  })

  $foreground.on('mousemove', function(e) {
    if (dragging) {
      var deltaX = e.clientX - previousDragPosition[0]
        , deltaY = e.clientY - previousDragPosition[1]

      body.scrollLeft -= deltaX
      body.scrollTop  -= deltaY

      wasDragging = true
    }
    previousDragPosition = [e.clientX, e.clientY]
  })

  $foreground.on('mouseup mouseleave', function() {
    dragging = false
    previousDragPosition = null
  })

  // Discard click events after dragging (very annoying otherwise)
  $(document).on('click', 'a.app-link', function(e) {
    if (wasDragging) {
      e.preventDefault()
    }
    wasDragging = false
  })
</script>
</body>
</html>
